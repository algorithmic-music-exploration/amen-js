<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
	  <title>Amen:  Upload Example</title>
</head>

<body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="amen.js"></script>
<script type="text/javascript">

var doRemix = function(urls) {
  var context = new AudioContext();
  var trackUrl = urls.audio;
  var analysisUrl = urls.analysis;

  var amen = initializeAmen(context, $);
  var player = amen.getPlayer();

  var remixFunction = function(t) {
    if (t.status = "ok") {
      var out = []
      out.push(t.analysis.beats[0]);
      out.push(t.analysis.beats[0]);
      out.push(t.analysis.beats[0]);
      out.push(t.analysis.beats[0]);
      player.play(0, out);
    }
  };
  amen.loadTrack(analysisUrl, trackUrl).then(remixFunction);
}
 
var pollUrl = function(url, fn, data, time){
  $.ajax({
    url : url,
    type : 'HEAD',
    success : function(){
      fn(data);
      console.log("200!");
    },
    error : function(){
      console.log("fail, waiting for ", time);
      setTimeout(function() {
        pollUrl(url, fn, data, time + time / 2);
      }, time);
    }
  });
}

var responseHandler = function(res) {
  if (res.target.readyState === 4) {
    var urls = $.parseJSON(res.target.response);
    pollUrl(urls.audio, doRemix, urls, 200);
  } 
}

var uploadFile = function() {
  var input = $("input")[0];
	var file = input.files[0];
	var fd = new FormData();
	fd.append('file', file);
	var xhr = new XMLHttpRequest();
	var url = '<YOUR_AMEN_SERVER_URL_HERE>';
	xhr.open('POST', url, true);
	xhr.onreadystatechange = responseHandler;
	xhr.send(fd);
	console.log("req sent!");
}

</script>


<form enctype="multipart/form-data" action="/upload/image" method="post">
    <input id="file" type="file" />
</form>
<button onclick="uploadFile()">Upload!</button>

Hello, this is an example of uploading for amen.js
</body>
</html>
